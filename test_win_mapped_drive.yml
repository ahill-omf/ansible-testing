---
- name: Test credential and win mapped drive
  hosts: all
  gather_facts: false
  vars:
    sva_pass: !vault |
      $ANSIBLE_VAULT;1.1;AES256
      34623562343236366331616435316139626532623563623065646138383563363236666430306161
      3763363439666430633932323831396135336437666134320a326433376266363633346234636236
      33313265353138626338386136626666393964633033636133383234333432303866636338643333
      3835663230633164360a633533373661643835343236303437333339373462636661353431313934
      30383937613231363565366261386364363664313664373761373935353661613337
  tasks:
    - name: Create a mapped drive that requires authentication
      community.windows.win_mapped_drive:
        letter: M
        path: \\corp.fin\shared
        state: present
        # username: t2222009-sva@CORP.FIN
        # password: "{{ sva_pass | string }}"
      vars:
        # become is required to save and retrieve the credentials in the tasks
        ansible_become: true
        ansible_become_method: runas
        ansible_become_user: '{{ ansible_user }}'
        ansible_become_pass: '{{ sva_pass | string }}'